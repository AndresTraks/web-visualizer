(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"1MA0":function(t,e,s){"use strict";s.r(e),s.d(e,"HarwellModule",(function(){return v}));var r=s("ofXK"),n=s("tyNb"),a=s("JKqQ"),o=s("NCiM"),i=s("kCbX"),c=s("uhFJ"),d=s("7G6I");class h{constructor(){this.data={};for(let t=1;t<=99;t++)this.data[String(t).padStart(2,"0")]=0;this.tapeNumber=1}get(t){return this.data[t]}add(t,e){this.data[t]=Number((this.data[t]+e).toFixed(7))}subtract(t,e){this.data[t]=Number((this.data[t]-e).toFixed(7))}multiply(t,e){const s=this.get(t)*this.get(e);this.data["09"]=Number(s.toFixed(7)),this.clear(e)}divide(t,e){const s=this.get("09")/this.get(t),r=this.get("09")%this.get(t);this.data[e]=Number(s.toFixed(7)),this.data["09"]=Number(r.toFixed(7))}clear(t){this.data[t]=0}}class u{constructor(t){this.code=t}static fromCode(t){return new u(t)}get operation(){return this.code[0]}get addressA(){return this.code.substr(1,2)}get addressB(){return this.code.substr(3,2)}}class p{constructor(t){this.value=t}valueOf(){return this.value}}class l{constructor(t){this.blockNumber=t}}class b{constructor(t){this.entries=t,this.index=0}static parse(t){const e=[];return t.split("\n").forEach(t=>{if(5===t.length)e.push(u.fromCode(t));else if(9===t.length){const s=Number(t)/1e7;e.push(new p(s))}else if(3===t.length){const s=Number(t.substr(1,1));e.push(new l(s))}}),new b(e)}searchBlock(t){const e=this.index;for(;;){const s=this.readEntry();if(s instanceof l&&s.blockNumber===t)return;if(this.index===e)throw new Error("Block not found on tape after full loop")}}readInstruction(){return this.readEntry()}readData(){return this.readEntry()}peekData(){return this.peekEntry()}peekTapeDataAfterInstruction(){return this.peekEntryAt(this.index+1)}readEntry(){const t=this.peekEntry();return this.index++,this.index>=this.entries.length&&(this.index=0),t}peekEntry(){if(0===this.entries.length)throw new Error("No entry on tape to read.");return this.entries[this.index]}peekEntryAt(t){if(0===this.entries.length)throw new Error("No entry on tape to read.");return this.entries[t]}}class g{constructor(){this.tapes=new Map,this.state=new h,this.output=[""]}setTape(t,e){this.tapes[t]=b.parse(e)}get currentTape(){return this.tapes[this.state.tapeNumber]}step(){if(this.state.finished)return;const t=this.currentTape.readEntry();if(t instanceof l)return;const e=t;switch(e.operation){case"0":this.control(e.addressA,e.addressB);break;case"1":this.add(e.addressA,e.addressB);break;case"2":this.addAndClear(e.addressA,e.addressB);break;case"3":this.subtract(e.addressA,e.addressB);break;case"4":this.subtractAndClear(e.addressA,e.addressB);break;case"5":this.multiply(e.addressA,e.addressB);break;case"6":this.divide(e.addressA,e.addressB);break;default:throw new Error("Unknown instruction "+e.code)}}control(t,e){if("3"!==t[0]){if("5"!==t[0]){switch(t){case"01":"00"===e&&this.finish();case"11":return void this.testPositive(e);case"12":return void this.testNegative(e);case"21":return void this.transferControl(e);case"22":return void(this.state.yes&&this.transferControl(e));case"73":return void this.printLayoutReference1();case"74":return void this.printLayoutReference2()}throw new Error("Unknown control instruction 0"+t+e)}if(this.state.yes){const s=Number(t[1]),r=Number(e);this.searchBlock(s,r)}}else{const s=Number(t[1]),r=Number(e);this.searchBlock(s,r)}}add(t,e){const s=this.load(t);"01"!==e?this.state.add(e,s):this.print(s)}addAndClear(t,e){this.add(t,e),this.state.clear(t)}subtract(t,e){const s=this.load(t);"01"!==e?this.state.subtract(e,s):this.print(s)}subtractAndClear(t,e){this.subtract(t,e),this.state.clear(t)}multiply(t,e){this.state.multiply(t,e)}divide(t,e){this.state.divide(t,e)}testPositive(t){this.state.yes=this.load(t)>0}testNegative(t){this.state.yes=this.load(t)<0}searchBlock(t,e){this.tapes[e].searchBlock(t)}transferControl(t){this.state.tapeNumber=Number(t)}finish(){this.state.finished=!0}printLayoutReference1(){this.state.printLayout=1}printLayoutReference2(){this.state.printLayout=2}print(t){const e=(t<0?"-":"+")+t.toFixed(7);1===this.state.printLayout?this.output[this.output.length-1]+=e+"   ":2===this.state.printLayout&&(this.output[this.output.length-1]+=e,this.output.push(""))}peek(t){return"01"==t?this.currentTape.peekData().valueOf():this.state.get(t)}peekTapeDataAfterInstruction(){return this.currentTape.peekTapeDataAfterInstruction().valueOf()}load(t){return"01"==t?this.currentTape.readData().valueOf():this.state.get(t)}}var f=s("FCAv"),m=s("+pcE");class w{constructor(t,e){this.value=0,this.indicators=t,this.position=e}}let k=(()=>{class t extends i.a{static createTube(t,e){const s=2*Math.PI/10,r=[];let n=0;for(let a=0;a<10;a++){const a=new c.a(t*Math.cos(n),0,t*Math.sin(n)),o=new c.a(t*Math.cos(n),-e,t*Math.sin(n)),i=new c.a(0,-e,0),d=c.a.zero;n+=s;const h=new c.a(t*Math.cos(n),0,t*Math.sin(n)),u=new c.a(t*Math.cos(n),-e,t*Math.sin(n));this.pushTriangle(r,a,d,h),this.pushTriangle(r,i,o,u),this.pushTriangle(r,a,h,o),this.pushTriangle(r,o,h,u)}return r}static createTubeRow(t){const e=[],s=this.createTube(.015,.05),r=new c.a(-.23,0,t);for(let n=0;n<5;n++)s.forEach(t=>{e.push(t.add(r))}),r.x+=.0425;r.x+=.1;for(let n=0;n<4;n++)s.forEach(t=>{e.push(t.add(r))}),r.x+=.0425;return e}static createMemoryUnit(){const t=[];for(let e=0;e<5;e++)this.createTubeRow(e*this.tubeDistance-.22).forEach(e=>{t.push(e)});for(let e=5;e<10;e++)this.createTubeRow(e*this.tubeDistance-.165).forEach(e=>{t.push(e)});return t}}return t.tubeDistance=.0425,t})();class A extends m.a{constructor(t,e,s,r,n){super(n),this.position=r;const a=m.a.withMesh(t,n);a.color=[.5,.5,.5,1],a.worldTransform=f.a.rotationX(Math.PI/2).multiply(f.a.translation(r));const d=m.a.withMesh(new o.a(i.a.createBox(new c.a(.25,.25,.1)),this.gl),n);d.color=[.5,.5,.5,1],d.worldTransform=f.a.translation(r.add(new c.a(0,0,-.15)));const h=m.a.withMesh(e,n);h.color=[.2,.2,.2,1],h.worldTransform=f.a.rotationX(Math.PI/2).multiply(f.a.translation(r)),this.children=[a,d,h],this.createRegisters(s,n)}createRegisters(t,e){this.registers=[];let s=this.position.add(new c.a(-.23,.22,0));for(let r=0;r<5;r++){const n=this.createIndicators(t,e);this.registers[r]=new w(n,s),s=s.add(new c.a(0,-k.tubeDistance,0))}s=s.add(new c.a(0,-.055,0));for(let r=5;r<10;r++){const n=this.createIndicators(t,e);this.registers[r]=new w(n,s),s=s.add(new c.a(0,-k.tubeDistance,0))}}createIndicators(t,e){const s=[];for(let r=0;r<9;r++){const n=m.a.withMesh(t,e);n.program=e.emitterShader,n.color=[1,.2,.2,1],s[r]=n}return s}draw(){this.children.forEach(t=>{t.draw()}),this.renderingContext.emitterShader.use(),this.registers.forEach(t=>{let e=t.position;for(let s=0;s<5;s++)this.drawIndicator(t,s,e),e=e.add(new c.a(.0425,0,0));e=e.add(new c.a(.1,0,0));for(let s=5;s<9;s++)this.drawIndicator(t,s,e),e=e.add(new c.a(.0425,0,0))}),this.renderingContext.standardShader.use()}drawIndicator(t,e,s){const r=t.indicators[e];let n=0;0!==e&&(1===e&&e--,t.value<0&&e++,n=Number(t.value.toFixed(7)[e])*(2*Math.PI/10)),r.worldTransform=f.a.rotationX(Math.PI/2).multiply(f.a.translation(new c.a(0,.0095,0))).multiply(f.a.rotationZ(n)).multiply(f.a.translation(s)),r.draw()}}class y{constructor(t){this.processor=t}disassemble(t){if(t instanceof u)return t.code+" "+this.disassembleInstruction(t);if(t instanceof l)return"Block ID "+t.blockNumber.toString();throw Error("Cannot disassemble tape entry.")}disassembleInstruction(t){switch(t.operation){case"0":return this.disassembleControl(t);case"1":return this.disassembleAdd(t);case"2":return this.disassembleAddAndClear(t);case"3":return this.disassembleSubtract(t);case"4":return this.disassembleSubtractAndClear(t);case"5":return this.disassembleMultiply(t);case"6":return this.disassembleDivide(t);default:throw new Error("Unknown instruction "+t.code)}}disassembleControl(t){if("3"===t.addressA[0])return"SEARCH for block "+Number(t.addressA[1])+" on tape "+Number(t.addressB);if("5"===t.addressA[0])return"CONDITIONAL SEARCH for block "+Number(t.addressA[1])+" on tape "+Number(t.addressB)+" ("+(this.processor.state.yes?"YES":"NO")+")";switch(t.addressA){case"01":if("00"===t.addressB)return"FINISH";case"11":return"TEST POSITIVE ["+t.addressB+"] ("+this.processor.peek(t.addressB)+")";case"12":return"TEST NEGATIVE ["+t.addressB+"] ("+this.processor.peek(t.addressB)+")";case"21":return"TRANSFER to tape "+t.addressB;case"22":return"CONDITIONAL TRANSFER to tape "+t.addressB+" ("+(this.processor.state.yes?"YES":"NO")+")";case"73":return"PRINT LAYOUT REFERENCE 1";case"74":return"PRINT LAYOUT REFERENCE 2";default:throw new Error("Unknown control instruction "+t.code)}}disassembleAdd(t){const e="01"==t.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(t.addressA);if("01"===t.addressB)return"PRINT ["+t.addressA+"] ("+e+")";const s=this.processor.peek(t.addressB),r=this.formatNumberResult(s+e);return"["+t.addressB+"] += ["+t.addressA+"] ("+s+" + "+e+" = "+r+")"}disassembleAddAndClear(t){const e="01"==t.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(t.addressA);if("00"===t.addressB)return"CLEAR ["+t.addressA+"] ("+e+")";if("01"===t.addressB)return"PRINT ["+t.addressA+"] ("+e+")";const s=this.processor.peek(t.addressB),r=this.formatNumberResult(s+e);return"["+t.addressB+"] += ["+t.addressA+"]; CLEAR ["+t.addressA+"] ("+s+" + "+e+" = "+r+")"}disassembleSubtract(t){const e="01"==t.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(t.addressA);if("00"===t.addressB)return"CLEAR ["+t.addressA+"] ("+e+")";if("01"===t.addressB)return"PRINT ["+t.addressA+"] ("+e+")";const s=this.processor.peek(t.addressB),r=this.formatNumberResult(s-e);return"["+t.addressB+"] -= ["+t.addressA+"]; CLEAR ["+t.addressA+"] ("+s+" - "+e+" = "+r+")"}disassembleSubtractAndClear(t){const e="01"==t.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(t.addressA),s=this.processor.peek(t.addressB),r=this.formatNumberResult(s-e);return"["+t.addressB+"] -= ["+t.addressA+"] ("+s+" - "+e+" = "+r+")"}disassembleMultiply(t){const e=this.processor.peek(t.addressA),s=this.processor.peek(t.addressA),r=(e*s).toFixed(7);return"[09] = ["+t.addressA+"] * ["+t.addressB+"] ("+e+" * "+s+" = "+r+")"}disassembleDivide(t){const e=this.processor.peek("09"),s=this.processor.peek(t.addressA),r=this.formatNumberResult(e/s),n=this.formatNumberResult(e%s);return"["+t.addressB+"] = [09] / ["+t.addressA+"] ("+e+" / "+s+" = "+r+"); [09] = [09] % ["+t.addressA+"] ("+e+" % "+s+" = "+n+")"}formatNumberResult(t){return Number(t.toFixed(7)).toString()}}class N extends d.a{constructor(t){super(t),this.isSingleStepping=!0,this.isSingleStepDone=!0,this.processor=new g,this.disassembler=new y(this.processor),this.loadExampleProgram1(),this.disassembleNextInstruction();const e=new o.a(i.a.createCase(new c.a(.25,.05,.25)),t.gl),s=new o.a(k.createMemoryUnit(),t.gl),r=new o.a(i.a.createBox(new c.a(.0025,.003,.0036)),t.gl),n=this.createMemoryUnitNode(e,s,r,new c.a(-.5,1,0)),a=this.createMemoryUnitNode(e,s,r,new c.a(-.5,.5,0)),d=this.createMemoryUnitNode(e,s,r,new c.a(-.5,0,0)),h=this.createMemoryUnitNode(e,s,r,new c.a(-.5,-.5,0)),u=this.createMemoryUnitNode(e,s,r,new c.a(-1,1,0)),p=this.createMemoryUnitNode(e,s,r,new c.a(-1,.5,0)),l=this.createMemoryUnitNode(e,s,r,new c.a(-1,0,0)),b=this.createMemoryUnitNode(e,s,r,new c.a(-1,-.5,0)),f=this.createMemoryUnitNode(e,s,r,new c.a(-1.5,1,0));this.memoryBanks=[n,a,d,h,u,p,l,b,f],this.nodes=this.memoryBanks,this.light.position=new c.a(.5,2,.5),this.camera.eye=new c.a(0,.5,3.3),this.camera.target=new c.a(0,.25,0),this.clearColor=[.1,.1,.1,1]}createMemoryUnitNode(t,e,s,r){return new A(t,e,s,r,this.renderingContext)}loadExampleProgram1(){this.processor.setTape(1,"[1]\n20900\n21000\n22000\n23000\n24000\n25000\n10110\n+10000000\n10120\n+01000000\n10130\n+15500000\n03202\n02102\n"),this.processor.setTape(2,"[2]\n11040\n51040\n07300\n11001\n07400\n10901\n12010\n13040\n31040\n01140\n24000\n20900\n05202\n05202\n00100\n")}loadExampleProgram2(){this.processor.setTape(1,"[1]\n20900\n21000\n22000\n23000\n24000\n25000\n10110\n+05000000\n10120\n+90000000\n10130\n+10000000\n10140\n+20000000\n11050\n03202\n02102\n"),this.processor.setTape(2,"[2]\n07400\n11001\n33020\n01220\n05303\n02203\n25009\n64050\n20900\n15010\n03202\n"),this.processor.setTape(3,"[3]\n00100\n")}draw(t){super.draw(t),this.runProcessorForFrame(),this.copyStateToRenderObject(),this.renderingContext.standardShader.use(),this.nodes.forEach(t=>{t.draw()})}stepProcessor(){this.isSingleStepDone=!1}runProcessor(){this.isSingleStepping=!this.isSingleStepping}runProcessorForFrame(){this.isSingleStepping?this.isSingleStepDone||(this.processor.step(),this.disassembleNextInstruction(),this.isSingleStepDone=!0):(this.processor.step(),this.disassembleNextInstruction()),this.processor.state.finished&&(this.isSingleStepping=!0)}copyStateToRenderObject(){for(let t=0;t<9;t++){const e=this.memoryBanks[t];for(let s=0;s<10;s++){const r=e.registers[s],n=String(10*(t+1)+s);r.value=this.processor.peek(n)}}}disassembleNextInstruction(){const t=this.processor.currentTape.peekEntry();this.nextInstructionText=this.processor.state.finished?"(finished)":this.disassembler.disassemble(t),console.log(this.nextInstructionText)}}var I=s("4u2P"),C=s("fXoL"),E=s("jhN1"),T=s("S8xs");function S(t,e){if(1&t&&(C.Jb(0,"p",12),C.bc(1),C.Ib()),2&t){const t=e.$implicit;C.wb(1),C.cc(t)}}const x=[{path:"",component:(()=>{class t{constructor(t){this.isOrtographicProjection=!1,t.setTitle("Harwell Dekatron")}ngOnInit(){const t=this.appCanvas.surface.nativeElement.getContext("webgl");if(t){const e=new I.a(t);this.scene=new N(e),this.appCanvas.setScene(this.scene)}}onStep(){this.scene.stepProcessor()}onRun(){this.scene.runProcessor()}onChangeOrtographicProjection(){this.isOrtographicProjection=!this.isOrtographicProjection,this.scene.camera.orthographic=this.isOrtographicProjection}}return t.\u0275fac=function(e){return new(e||t)(C.Gb(E.b))},t.\u0275cmp=C.Ab({type:t,selectors:[["harwell-component"]],viewQuery:function(t,e){var s;1&t&&C.Zb(a.a,!0),2&t&&C.Wb(s=C.Qb())&&(e.appCanvas=s.first)},decls:35,vars:9,consts:[["id","bodyContainer"],["id","leftPanel"],[3,"isAnimated"],[3,"isOpen"],["accordion-heading","","type","button",1,"btn","btn-link","btn-block","clearfix"],[1,"badge","badge-arrow","float-left"],[1,"float-left"],[1,"btn-toolbar","mb-2"],["type","button",1,"btn","btn-primary","mr-2",3,"disabled","click"],[2,"min-height","3em"],["class","mb-0",4,"ngFor","ngForOf"],["value","ds","type","checkbox",3,"checked","change"],[1,"mb-0"]],template:function(t,e){1&t&&(C.Jb(0,"div",0),C.Jb(1,"div",1),C.Jb(2,"accordion",2),C.Jb(3,"accordion-group",3),C.Jb(4,"button",4),C.Jb(5,"span",5),C.bc(6,"\u2b9e"),C.Ib(),C.Jb(7,"span",6),C.bc(8,"Control"),C.Ib(),C.Ib(),C.Jb(9,"div",7),C.Jb(10,"button",8),C.Pb("click",(function(){return e.onStep()})),C.bc(11,"Step"),C.Ib(),C.Jb(12,"button",8),C.Pb("click",(function(){return e.onRun()})),C.bc(13),C.Ib(),C.Hb(14,"br"),C.Ib(),C.Hb(15,"div"),C.Jb(16,"p",9),C.bc(17),C.Ib(),C.Ib(),C.Jb(18,"accordion-group",3),C.Jb(19,"button",4),C.Jb(20,"span",5),C.bc(21,"\u2b9e"),C.Ib(),C.Jb(22,"span",6),C.bc(23,"Output"),C.Ib(),C.Ib(),C.ac(24,S,2,1,"p",10),C.Ib(),C.Jb(25,"accordion-group"),C.Jb(26,"button",4),C.Jb(27,"span",5),C.bc(28,"\u2b9e"),C.Ib(),C.Jb(29,"span",6),C.bc(30,"Settings"),C.Ib(),C.Ib(),C.Jb(31,"label"),C.Jb(32,"input",11),C.Pb("change",(function(){return e.onChangeOrtographicProjection()})),C.Ib(),C.bc(33," Orthographic projection "),C.Ib(),C.Ib(),C.Ib(),C.Ib(),C.Hb(34,"app-canvas"),C.Ib()),2&t&&(C.wb(2),C.Ub("isAnimated",!0),C.wb(1),C.Ub("isOpen",!0),C.wb(7),C.Ub("disabled",e.scene.processor.state.finished),C.wb(2),C.Ub("disabled",e.scene.processor.state.finished),C.wb(1),C.dc(" ",e.scene.isSingleStepping?"Run":"Stop"," "),C.wb(4),C.dc("Next: ",e.scene.nextInstructionText,""),C.wb(1),C.Ub("isOpen",!0),C.wb(6),C.Ub("ngForOf",e.scene.processor.output),C.wb(8),C.Ub("checked",e.isOrtographicProjection))},directives:[T.a,T.c,r.i,a.a],styles:["#leftPanel[_ngcontent-%COMP%]{width:350px;height:768px;float:left;overflow-y:auto;white-space:normal}#bodyContainer[_ngcontent-%COMP%]{white-space:nowrap}.badge-arrow[_ngcontent-%COMP%]{margin-top:4px;transition-duration:.2s;transition-property:transform}.panel-open[_ngcontent-%COMP%]   .badge-arrow[_ngcontent-%COMP%]{transform:rotate(90deg)}ul[_ngcontent-%COMP%]{padding-left:25px}.gear-group-a[_ngcontent-%COMP%]{background-color:#99801a}.gear-group-l[_ngcontent-%COMP%]{background-color:#e6801a}.gear-group-n[_ngcontent-%COMP%]{background-color:#40bf4d}.gear-group-o[_ngcontent-%COMP%]{background-color:#fff}.gear-group-p[_ngcontent-%COMP%]{background-color:#80bf33}.gear-group-e[_ngcontent-%COMP%]{background-color:#7366b3}.gear-group-h[_ngcontent-%COMP%]{background-color:#a666b3}.gear-group-c[_ngcontent-%COMP%]{background-color:#80bfe6}.gear-group-k[_ngcontent-%COMP%]{background-color:#73ccbf}"]}),t})()}];let P=(()=>{class t{}return t.\u0275mod=C.Eb({type:t}),t.\u0275inj=C.Db({factory:function(e){return new(e||t)},imports:[[n.a.forChild(x)],n.a]}),t})();var M=s("YP2Z");let v=(()=>{class t{}return t.\u0275mod=C.Eb({type:t}),t.\u0275inj=C.Db({factory:function(e){return new(e||t)},imports:[[r.b,P,M.a,T.b.forRoot()]]}),t})()}}]);