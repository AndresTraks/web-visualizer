(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"1MA0":function(e,t,s){"use strict";s.r(t),s.d(t,"HarwellModule",(function(){return v}));var r=s("ofXK"),n=s("tyNb"),a=s("JKqQ"),o=s("NCiM"),i=s("kCbX"),c=s("uhFJ"),d=s("7G6I");class h{constructor(){this.data={};for(let e=1;e<=99;e++)this.data[String(e).padStart(2,"0")]=0;this.tapeNumber=1}get(e){return this.data[e]}add(e,t){this.data[e]=Number((this.data[e]+t).toFixed(7))}subtract(e,t){this.data[e]=Number((this.data[e]-t).toFixed(7))}multiply(e,t){const s=this.get(e)*this.get(t);this.data["09"]=Number(s.toFixed(7)),this.clear(t)}divide(e,t){const s=this.get("09")/this.get(e),r=this.get("09")%this.get(e);this.data[t]=Number(s.toFixed(7)),this.data["09"]=Number(r.toFixed(7))}clear(e){this.data[e]=0}}class u{constructor(e){this.code=e}static fromCode(e){return new u(e)}get operation(){return this.code[0]}get addressA(){return this.code.substr(1,2)}get addressB(){return this.code.substr(3,2)}}class p{constructor(e){this.value=e}valueOf(){return this.value}}class l{constructor(e){this.blockNumber=e}}class b{constructor(e){this.entries=e,this.index=0}static parse(e){const t=[];return e.split("\n").forEach(e=>{if(5===e.length)t.push(u.fromCode(e));else if(9===e.length){const s=Number(e)/1e7;t.push(new p(s))}else if(3===e.length){const s=Number(e.substr(1,1));t.push(new l(s))}}),new b(t)}searchBlock(e){const t=this.index;for(;;){const s=this.readEntry();if(s instanceof l&&s.blockNumber===e)return;if(this.index===t)throw new Error("Block not found on tape after full loop")}}readInstruction(){return this.readEntry()}readData(){return this.readEntry()}peekData(){return this.peekEntry()}peekTapeDataAfterInstruction(){return this.peekEntryAt(this.index+1)}readEntry(){const e=this.peekEntry();return this.index++,this.index>=this.entries.length&&(this.index=0),e instanceof l&&(this.blockNumber=e.blockNumber),e}peekEntry(){if(0===this.entries.length)throw new Error("No entry on tape to read.");return this.entries[this.index]}peekEntryAt(e){if(0===this.entries.length)throw new Error("No entry on tape to read.");return this.entries[e]}}class g{constructor(){this.tapes=new Map,this.state=new h,this.output=[""]}setTape(e,t){this.tapes[e]=b.parse(t)}get currentTape(){return this.tapes[this.state.tapeNumber]}step(){if(this.state.finished)return;const e=this.currentTape.readEntry();if(e instanceof l)return;const t=e;switch(t.operation){case"0":this.control(t.addressA,t.addressB);break;case"1":this.add(t.addressA,t.addressB);break;case"2":this.addAndClear(t.addressA,t.addressB);break;case"3":this.subtract(t.addressA,t.addressB);break;case"4":this.subtractAndClear(t.addressA,t.addressB);break;case"5":this.multiply(t.addressA,t.addressB);break;case"6":this.divide(t.addressA,t.addressB);break;default:throw new Error("Unknown instruction "+t.code)}}control(e,t){if("3"!==e[0]){if("5"!==e[0]){switch(e){case"01":"00"===t&&this.finish();case"11":return void this.testPositive(t);case"12":return void this.testNegative(t);case"21":return void this.transferControl(t);case"22":return void(this.state.yes&&this.transferControl(t));case"73":return void this.printLayoutReference1();case"74":return void this.printLayoutReference2()}throw new Error("Unknown control instruction 0"+e+t)}if(this.state.yes){const s=Number(e[1]),r=Number(t);this.searchBlock(s,r)}}else{const s=Number(e[1]),r=Number(t);this.searchBlock(s,r)}}add(e,t){const s=this.load(e);"01"!==t?this.state.add(t,s):this.print(s)}addAndClear(e,t){this.add(e,t),this.state.clear(e)}subtract(e,t){const s=this.load(e);"01"!==t?this.state.subtract(t,s):this.print(s)}subtractAndClear(e,t){this.subtract(e,t),this.state.clear(e)}multiply(e,t){this.state.multiply(e,t)}divide(e,t){this.state.divide(e,t)}testPositive(e){this.state.yes=this.load(e)>0}testNegative(e){this.state.yes=this.load(e)<0}searchBlock(e,t){this.tapes[t].searchBlock(e)}transferControl(e){this.state.tapeNumber=Number(e)}finish(){this.state.finished=!0}printLayoutReference1(){this.state.printLayout=1}printLayoutReference2(){this.state.printLayout=2}print(e){const t=(e<0?"-":"+")+e.toFixed(7);1===this.state.printLayout?this.output[this.output.length-1]+=t+"   ":2===this.state.printLayout&&(this.output[this.output.length-1]+=t,this.output.push(""))}peek(e){return"01"==e?this.currentTape.peekData().valueOf():this.state.get(e)}peekTapeDataAfterInstruction(){return this.currentTape.peekTapeDataAfterInstruction().valueOf()}load(e){return"01"==e?this.currentTape.readData().valueOf():this.state.get(e)}}var m=s("FCAv"),f=s("+pcE");class w{constructor(e,t){this.value=0,this.indicators=e,this.position=t}}let k=(()=>{class e extends i.a{static createTube(e,t){const s=2*Math.PI/10,r=[];let n=0;for(let a=0;a<10;a++){const a=new c.a(e*Math.cos(n),0,e*Math.sin(n)),o=new c.a(e*Math.cos(n),-t,e*Math.sin(n)),i=new c.a(0,-t,0),d=c.a.zero;n+=s;const h=new c.a(e*Math.cos(n),0,e*Math.sin(n)),u=new c.a(e*Math.cos(n),-t,e*Math.sin(n));this.pushTriangle(r,a,d,h),this.pushTriangle(r,i,o,u),this.pushTriangle(r,a,h,o),this.pushTriangle(r,o,h,u)}return r}static createTubeRow(e){const t=[],s=this.createTube(.015,.05),r=new c.a(-.23,0,e);for(let n=0;n<5;n++)s.forEach(e=>{t.push(e.add(r))}),r.x+=.0425;r.x+=.1;for(let n=0;n<4;n++)s.forEach(e=>{t.push(e.add(r))}),r.x+=.0425;return t}static createMemoryUnit(){const e=[];for(let t=0;t<5;t++)this.createTubeRow(t*this.tubeDistance-.22).forEach(t=>{e.push(t)});for(let t=5;t<10;t++)this.createTubeRow(t*this.tubeDistance-.165).forEach(t=>{e.push(t)});return e}}return e.tubeDistance=.0425,e})();class y extends f.a{constructor(e,t,s,r,n){super(n),this.position=r;const a=f.a.withMesh(e,n);a.color=[.5,.5,.5,1],a.worldTransform=m.a.rotationX(Math.PI/2).multiply(m.a.translation(r));const d=f.a.withMesh(new o.a(i.a.createBox(new c.a(.25,.25,.1)),this.gl),n);d.color=[.5,.5,.5,1],d.worldTransform=m.a.translation(r.add(new c.a(0,0,-.15)));const h=f.a.withMesh(t,n);h.color=[.2,.2,.2,1],h.worldTransform=m.a.rotationX(Math.PI/2).multiply(m.a.translation(r)),this.children=[a,d,h],this.createRegisters(s,n)}createRegisters(e,t){this.registers=[];let s=this.position.add(new c.a(-.23,.22,0));for(let r=0;r<5;r++){const n=this.createIndicators(e,t);this.registers[r]=new w(n,s),s=s.add(new c.a(0,-k.tubeDistance,0))}s=s.add(new c.a(0,-.055,0));for(let r=5;r<10;r++){const n=this.createIndicators(e,t);this.registers[r]=new w(n,s),s=s.add(new c.a(0,-k.tubeDistance,0))}}createIndicators(e,t){const s=[];for(let r=0;r<9;r++){const n=f.a.withMesh(e,t);n.program=t.emitterShader,n.color=[1,.2,.2,1],s[r]=n}return s}draw(){this.children.forEach(e=>{e.draw()}),this.renderingContext.emitterShader.use(),this.registers.forEach(e=>{let t=e.position;for(let s=0;s<5;s++)this.drawIndicator(e,s,t),t=t.add(new c.a(.0425,0,0));t=t.add(new c.a(.1,0,0));for(let s=5;s<9;s++)this.drawIndicator(e,s,t),t=t.add(new c.a(.0425,0,0))}),this.renderingContext.standardShader.use()}drawIndicator(e,t,s){const r=e.indicators[t];let n=0;0!==t&&(1===t&&t--,e.value<0&&t++,n=Number(e.value.toFixed(7)[t])*(2*Math.PI/10)),r.worldTransform=m.a.rotationX(Math.PI/2).multiply(m.a.translation(new c.a(0,.0095,0))).multiply(m.a.rotationZ(n)).multiply(m.a.translation(s)),r.draw()}}class A{constructor(e){this.processor=e}disassemble(e){if(e instanceof u)return e.code+" "+this.disassembleInstruction(e);if(e instanceof l)return"Block ID "+e.blockNumber.toString();throw Error("Cannot disassemble tape entry.")}disassembleInstruction(e){switch(e.operation){case"0":return this.disassembleControl(e);case"1":return this.disassembleAdd(e);case"2":return this.disassembleAddAndClear(e);case"3":return this.disassembleSubtract(e);case"4":return this.disassembleSubtractAndClear(e);case"5":return this.disassembleMultiply(e);case"6":return this.disassembleDivide(e);default:throw new Error("Unknown instruction "+e.code)}}disassembleControl(e){if("3"===e.addressA[0])return"SEARCH for block "+Number(e.addressA[1])+" on tape "+Number(e.addressB);if("5"===e.addressA[0])return"CONDITIONAL SEARCH for block "+Number(e.addressA[1])+" on tape "+Number(e.addressB)+" ("+(this.processor.state.yes?"YES":"NO")+")";switch(e.addressA){case"01":if("00"===e.addressB)return"FINISH";case"11":return"TEST POSITIVE ["+e.addressB+"] ("+this.processor.peek(e.addressB)+")";case"12":return"TEST NEGATIVE ["+e.addressB+"] ("+this.processor.peek(e.addressB)+")";case"21":return"TRANSFER to tape "+e.addressB;case"22":return"CONDITIONAL TRANSFER to tape "+e.addressB+" ("+(this.processor.state.yes?"YES":"NO")+")";case"73":return"PRINT LAYOUT REFERENCE 1";case"74":return"PRINT LAYOUT REFERENCE 2";default:throw new Error("Unknown control instruction "+e.code)}}disassembleAdd(e){const t="01"==e.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(e.addressA);if("01"===e.addressB)return"PRINT ["+e.addressA+"] ("+t+")";const s=this.processor.peek(e.addressB),r=this.formatNumberResult(s+t);return"["+e.addressB+"] += ["+e.addressA+"] ("+s+" + "+t+" = "+r+")"}disassembleAddAndClear(e){const t="01"==e.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(e.addressA);if("00"===e.addressB)return"CLEAR ["+e.addressA+"] ("+t+")";if("01"===e.addressB)return"PRINT ["+e.addressA+"] ("+t+")";const s=this.processor.peek(e.addressB),r=this.formatNumberResult(s+t);return"["+e.addressB+"] += ["+e.addressA+"]; CLEAR ["+e.addressA+"] ("+s+" + "+t+" = "+r+")"}disassembleSubtract(e){const t="01"==e.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(e.addressA);if("00"===e.addressB)return"CLEAR ["+e.addressA+"] ("+t+")";if("01"===e.addressB)return"PRINT ["+e.addressA+"] ("+t+")";const s=this.processor.peek(e.addressB),r=this.formatNumberResult(s-t);return"["+e.addressB+"] -= ["+e.addressA+"]; CLEAR ["+e.addressA+"] ("+s+" - "+t+" = "+r+")"}disassembleSubtractAndClear(e){const t="01"==e.addressA?this.processor.peekTapeDataAfterInstruction():this.processor.peek(e.addressA),s=this.processor.peek(e.addressB),r=this.formatNumberResult(s-t);return"["+e.addressB+"] -= ["+e.addressA+"] ("+s+" - "+t+" = "+r+")"}disassembleMultiply(e){const t=this.processor.peek(e.addressA),s=this.processor.peek(e.addressA),r=this.formatNumberResult(t*s);return"[09] = ["+e.addressA+"] * ["+e.addressB+"] ("+t+" * "+s+" = "+r+")"}disassembleDivide(e){const t=this.processor.peek("09"),s=this.processor.peek(e.addressA),r=this.formatNumberResult(t/s),n=this.formatNumberResult(t%s);return"["+e.addressB+"] = [09] / ["+e.addressA+"] ("+t+" / "+s+" = "+r+"); [09] = [09] % ["+e.addressA+"] ("+t+" % "+s+" = "+n+")"}formatNumberResult(e){return Number(e.toFixed(7)).toString()}}class N extends d.a{constructor(e){super(e),this.isSingleStepping=!0,this.isSingleStepDone=!0,this.processor=new g,this.disassembler=new A(this.processor),this.loadExampleProgram1();const t=new o.a(i.a.createCase(new c.a(.25,.05,.25)),e.gl),s=new o.a(k.createMemoryUnit(),e.gl),r=new o.a(i.a.createBox(new c.a(.0025,.003,.0036)),e.gl),n=this.createMemoryUnitNode(t,s,r,new c.a(-.5,1,0)),a=this.createMemoryUnitNode(t,s,r,new c.a(-.5,.5,0)),d=this.createMemoryUnitNode(t,s,r,new c.a(-.5,0,0)),h=this.createMemoryUnitNode(t,s,r,new c.a(-.5,-.5,0)),u=this.createMemoryUnitNode(t,s,r,new c.a(-1,1,0)),p=this.createMemoryUnitNode(t,s,r,new c.a(-1,.5,0)),l=this.createMemoryUnitNode(t,s,r,new c.a(-1,0,0)),b=this.createMemoryUnitNode(t,s,r,new c.a(-1,-.5,0)),m=this.createMemoryUnitNode(t,s,r,new c.a(-1.5,1,0));this.memoryBanks=[n,a,d,h,u,p,l,b,m],this.nodes=this.memoryBanks,this.light.position=new c.a(.5,2,.5),this.camera.eye=new c.a(0,.5,3.3),this.camera.target=new c.a(0,.25,0),this.clearColor=[.1,.1,.1,1]}createMemoryUnitNode(e,t,s,r){return new y(e,t,s,r,this.renderingContext)}onProgramChange(e){"1"===e&&this.loadExampleProgram1(),"2"===e&&this.loadExampleProgram2()}loadExampleProgram1(){this.processor.setTape(1,"[1]\n20900\n21000\n22000\n23000\n24000\n25000\n10110\n+10000000\n10120\n+01000000\n10130\n+15500000\n03202\n02102\n"),this.processor.setTape(2,"[2]\n11040\n51040\n07300\n11001\n07400\n10901\n12010\n13040\n31040\n01140\n24000\n20900\n05202\n05202\n00100\n"),this.resetProgram()}loadExampleProgram2(){this.processor.setTape(1,"[1]\n20900\n21000\n22000\n23000\n24000\n25000\n10110\n+05000000\n10120\n+90000000\n10130\n+10000000\n10140\n+20000000\n11050\n03202\n02102\n"),this.processor.setTape(2,"[2]\n07400\n11001\n33020\n01220\n05303\n02203\n25009\n64050\n20900\n15010\n03202\n"),this.processor.setTape(3,"[3]\n00100\n"),this.resetProgram()}resetProgram(){this.processor.output=[""],this.isSingleStepping=!0,this.isSingleStepDone=!0,this.processor.state.finished=!1,this.processor.state.tapeNumber=1,this.disassembleNextInstruction()}draw(e){super.draw(e),this.runProcessorForFrame(),this.copyStateToRenderObject(),this.renderingContext.standardShader.use(),this.nodes.forEach(e=>{e.draw()})}stepProcessor(){this.isSingleStepping=!0,this.isSingleStepDone=!1}runProcessor(){this.isSingleStepping=!this.isSingleStepping}runProcessorForFrame(){this.isSingleStepping?this.isSingleStepDone||(this.processor.step(),this.disassembleNextInstruction(),this.isSingleStepDone=!0):(this.processor.step(),this.disassembleNextInstruction()),this.processor.state.finished&&(this.isSingleStepping=!0)}copyStateToRenderObject(){for(let e=0;e<9;e++){const t=this.memoryBanks[e];for(let s=0;s<10;s++){const r=t.registers[s],n=String(10*(e+1)+s);r.value=this.processor.peek(n)}}}disassembleNextInstruction(){const e=this.processor.currentTape.peekEntry();this.nextInstructionText=this.processor.state.finished?"(finished)":this.disassembler.disassemble(e),console.log(this.nextInstructionText)}}var I=s("4u2P"),C=s("fXoL"),E=s("jhN1"),P=s("S8xs");function T(e,t){if(1&e&&(C.Jb(0,"p",14),C.bc(1),C.Ib()),2&e){const e=t.$implicit;C.wb(1),C.cc(e)}}const S=[{path:"",component:(()=>{class e{constructor(e){this.isOrtographicProjection=!1,e.setTitle("Harwell Dekatron")}ngOnInit(){const e=this.appCanvas.surface.nativeElement.getContext("webgl");if(e){const t=new I.a(e);this.scene=new N(t),this.appCanvas.setScene(this.scene)}}onChangeOrtographicProjection(){this.isOrtographicProjection=!this.isOrtographicProjection,this.scene.camera.orthographic=this.isOrtographicProjection}}return e.\u0275fac=function(t){return new(t||e)(C.Gb(E.b))},e.\u0275cmp=C.Ab({type:e,selectors:[["harwell-component"]],viewQuery:function(e,t){var s;1&e&&C.Zb(a.a,!0),2&e&&C.Wb(s=C.Qb())&&(t.appCanvas=s.first)},decls:43,vars:11,consts:[["id","bodyContainer"],["id","leftPanel"],[3,"isAnimated"],[3,"isOpen"],["accordion-heading","","type","button",1,"btn","btn-link","btn-block","clearfix"],[1,"badge","badge-arrow","float-left"],[1,"float-left"],["aria-label","Default select example",1,"form-select","mb-3",3,"change"],["value","1","selected",""],["value","2"],[1,"btn-toolbar","mb-3"],["type","button",1,"btn","btn-primary","mr-2",3,"disabled","click"],["type","button",1,"btn","btn-primary","mr-4",3,"disabled","click"],["type","button",1,"btn","btn-primary","mr-2",3,"click"],[1,"mb-0"],[2,"min-height","5em"],["class","mb-0",4,"ngFor","ngForOf"],["value","ds","type","checkbox",3,"checked","change"]],template:function(e,t){1&e&&(C.Jb(0,"div",0),C.Jb(1,"div",1),C.Jb(2,"accordion",2),C.Jb(3,"accordion-group",3),C.Jb(4,"button",4),C.Jb(5,"span",5),C.bc(6,"\u2b9e"),C.Ib(),C.Jb(7,"span",6),C.bc(8,"Control"),C.Ib(),C.Ib(),C.Jb(9,"select",7),C.Pb("change",(function(e){return t.scene.onProgramChange(e.target.value)})),C.Jb(10,"option",8),C.bc(11,"Example program 1"),C.Ib(),C.Jb(12,"option",9),C.bc(13,"Example program 2"),C.Ib(),C.Ib(),C.Jb(14,"div",10),C.Jb(15,"button",11),C.Pb("click",(function(){return t.scene.stepProcessor()})),C.bc(16,"Step"),C.Ib(),C.Jb(17,"button",12),C.Pb("click",(function(){return t.scene.runProcessor()})),C.bc(18),C.Ib(),C.Jb(19,"button",13),C.Pb("click",(function(){return t.scene.resetProgram()})),C.bc(20,"Reload "),C.Ib(),C.Hb(21,"br"),C.Ib(),C.Jb(22,"p",14),C.bc(23),C.Ib(),C.Jb(24,"p",15),C.bc(25),C.Ib(),C.Ib(),C.Jb(26,"accordion-group",3),C.Jb(27,"button",4),C.Jb(28,"span",5),C.bc(29,"\u2b9e"),C.Ib(),C.Jb(30,"span",6),C.bc(31,"Output"),C.Ib(),C.Ib(),C.ac(32,T,2,1,"p",16),C.Ib(),C.Jb(33,"accordion-group"),C.Jb(34,"button",4),C.Jb(35,"span",5),C.bc(36,"\u2b9e"),C.Ib(),C.Jb(37,"span",6),C.bc(38,"Settings"),C.Ib(),C.Ib(),C.Jb(39,"label"),C.Jb(40,"input",17),C.Pb("change",(function(){return t.onChangeOrtographicProjection()})),C.Ib(),C.bc(41," Orthographic projection "),C.Ib(),C.Ib(),C.Ib(),C.Ib(),C.Hb(42,"app-canvas"),C.Ib()),2&e&&(C.wb(2),C.Ub("isAnimated",!0),C.wb(1),C.Ub("isOpen",!0),C.wb(12),C.Ub("disabled",t.scene.processor.state.finished),C.wb(2),C.Ub("disabled",t.scene.processor.state.finished),C.wb(1),C.dc(" ",t.scene.isSingleStepping?"Run":"Stop"," "),C.wb(5),C.ec("Tape ",t.scene.processor.state.tapeNumber,", block ",t.scene.processor.currentTape.blockNumber,""),C.wb(2),C.dc("Order: ",t.scene.nextInstructionText,""),C.wb(1),C.Ub("isOpen",!0),C.wb(6),C.Ub("ngForOf",t.scene.processor.output),C.wb(8),C.Ub("checked",t.isOrtographicProjection))},directives:[P.a,P.c,r.i,a.a],styles:["#leftPanel[_ngcontent-%COMP%]{width:350px;height:768px;float:left;overflow-y:auto;white-space:normal}#bodyContainer[_ngcontent-%COMP%]{white-space:nowrap}.badge-arrow[_ngcontent-%COMP%]{margin-top:4px;transition-duration:.2s;transition-property:transform}.panel-open[_ngcontent-%COMP%]   .badge-arrow[_ngcontent-%COMP%]{transform:rotate(90deg)}ul[_ngcontent-%COMP%]{padding-left:25px}.gear-group-a[_ngcontent-%COMP%]{background-color:#99801a}.gear-group-l[_ngcontent-%COMP%]{background-color:#e6801a}.gear-group-n[_ngcontent-%COMP%]{background-color:#40bf4d}.gear-group-o[_ngcontent-%COMP%]{background-color:#fff}.gear-group-p[_ngcontent-%COMP%]{background-color:#80bf33}.gear-group-e[_ngcontent-%COMP%]{background-color:#7366b3}.gear-group-h[_ngcontent-%COMP%]{background-color:#a666b3}.gear-group-c[_ngcontent-%COMP%]{background-color:#80bfe6}.gear-group-k[_ngcontent-%COMP%]{background-color:#73ccbf}"]}),e})()}];let x=(()=>{class e{}return e.\u0275mod=C.Eb({type:e}),e.\u0275inj=C.Db({factory:function(t){return new(t||e)},imports:[[n.a.forChild(S)],n.a]}),e})();var M=s("YP2Z");let v=(()=>{class e{}return e.\u0275mod=C.Eb({type:e}),e.\u0275inj=C.Db({factory:function(t){return new(t||e)},imports:[[r.b,x,M.a,P.b.forRoot()]]}),e})()}}]);